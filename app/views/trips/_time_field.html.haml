:ruby
  if time
    hour = time.hour 
    is_pm = hour >= 12
  end

.form-inline.time-field{class: field_name}
  = f.hidden_field field_name, value: time.try(:to_s, :time_only), class: 'time_field_value'
  = text_field_tag :hour, time.try(:strftime, "%I"), placeholder: 'HH', size: 3, maxlength: 2, class: 'form-control time_field_hour'
  %b= ':'
  = text_field_tag :minute, time.try(:strftime, "%M"), placeholder: 'MM', size: 3, maxlength: 2, class: 'form-control time_field_minute'
  %button.form-control.am-pm{type: 'button', role: 'button', data: {is_pm: is_pm ? 'true' : 'false'}}
    = is_pm ? 'PM' : 'AM'

:javascript
  $(function() {
    function update_time(time_field) {
      var hour = time_field.find('.time_field_hour').val().trim();
      var min = time_field.find('.time_field_minute').val().trim();
      var am_pm = time_field.find('.am-pm').text().trim();

      if(hour && parseInt(hour) >= 12) {
        var adjusted_hour = parseInt(hour);
        am_pm = 'PM';
        if(adjusted_hour > 12) {
          hour =  adjusted_hour - 12;
        }
      }

      time_field.find('.time_field_value').val(hour + ":" + min + " " + am_pm);      
    }

    $(document).on('click', 'button.am-pm', function() {
      if($(this).data('is-pm') != 'false') {
        $(this).data('is-pm', 'false');
        $(this).text('AM');
      } else {
        $(this).data('is-pm', 'true');
        $(this).text('PM');
      }

      update_time($(this).parents('.time-field'));
    });

    $(document).on('change', 'input.time_field_hour, input.time_field_minute', function() {
      update_time($(this).parents('.time-field'));
    });
  });